# 快速部署指南

## 🚀 一键部署（推荐）

### 使用远程数据库部署
你的 `config.py` 已经配置了远程数据库环境，可以直接使用：

```bash
# 1. 上传项目到服务器
scp -r ./image-convert-python root@your-server-ip:/tmp/

# 2. 连接服务器
ssh root@your-server-ip

# 3. 进入项目目录
cd /tmp/image-convert-python

# 4. 运行远程数据库部署脚本
chmod +x deploy/deploy_with_remote_db.sh
./deploy/deploy_with_remote_db.sh
```

### 使用本地数据库部署
如果你想在服务器上安装本地数据库：

```bash
# 1. 上传项目到服务器
scp -r ./image-convert-python root@your-server-ip:/tmp/

# 2. 连接服务器
ssh root@your-server-ip

# 3. 进入项目目录
cd /tmp/image-convert-python

# 4. 运行一键部署脚本
chmod +x deploy/one_click_deploy.sh
./deploy/one_click_deploy.sh
```

## 📋 当前配置信息

根据你的 `config.py` 文件，当前配置如下：

- **数据库地址**: `1.94.137.69:3306`
- **数据库名**: `image_convert_db`
- **数据库用户**: `root`
- **Redis地址**: `1.94.137.69:6379`
- **Redis密码**: `foobared`

## 🔧 部署过程说明

### 远程数据库部署流程
1. ✅ **跳过本地数据库安装** - 直接使用远程数据库
2. ✅ **跳过本地Redis安装** - 直接使用远程Redis
3. ✅ **安装Python和Nginx** - 运行应用和反向代理
4. ✅ **测试数据库连接** - 确保能连接到远程数据库
5. ✅ **初始化数据库表** - 在远程数据库中创建表结构
6. ✅ **配置Nginx** - 设置反向代理和静态文件服务
7. ✅ **启动服务** - 启动应用和定时任务

### 本地数据库部署流程
1. ✅ **安装MySQL** - 在服务器上安装MySQL
2. ✅ **安装Redis** - 在服务器上安装Redis
3. ✅ **创建数据库** - 创建本地数据库和用户
4. ✅ **修改配置** - 更新config.py使用本地数据库
5. ✅ **安装Python和Nginx** - 运行应用和反向代理
6. ✅ **初始化数据库** - 创建表结构
7. ✅ **配置Nginx** - 设置反向代理
8. ✅ **启动服务** - 启动所有服务

## 🎯 推荐方案

**建议使用远程数据库部署**，因为：

1. ✅ **配置简单** - 不需要修改config.py
2. ✅ **部署快速** - 跳过数据库安装步骤
3. ✅ **资源节省** - 不需要在服务器上运行数据库
4. ✅ **维护方便** - 数据库集中管理

## 📊 部署后验证

部署完成后，可以通过以下方式验证：

```bash
# 检查服务状态
systemctl status image-convert
systemctl status image-convert-scheduler
systemctl status nginx

# 测试API接口
curl http://localhost/health
curl http://localhost/docs

# 查看日志
journalctl -u image-convert -f
```

## 🔐 安全配置

部署完成后，建议进行以下安全配置：

1. **申请SSL证书**
```bash
certbot --nginx -d your-domain.com
```

2. **配置防火墙**
```bash
ufw allow 22
ufw allow 80
ufw allow 443
ufw enable
```

3. **定期备份**
```bash
# 备份脚本已自动创建
/var/www/image-convert/backup.sh
```

## 🚨 故障排除

如果部署过程中遇到问题：

1. **检查数据库连接**
```bash
python -c "from tools.database.database import engine; print('OK' if engine.connect() else 'FAIL')"
```

2. **检查服务日志**
```bash
journalctl -u image-convert --no-pager
```

3. **检查Nginx配置**
```bash
nginx -t
```

4. **重启服务**
```bash
systemctl restart image-convert
systemctl restart nginx
```

## 📞 技术支持

如果遇到问题，可以：

1. 查看详细日志：`journalctl -u service-name -f`
2. 检查配置文件：`/var/www/image-convert/config.py`
3. 测试数据库连接：使用项目中的测试脚本
4. 查看Nginx日志：`tail -f /var/log/nginx/error.log`

现在你可以选择适合的部署方式开始部署了！🎉
