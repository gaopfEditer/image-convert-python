# å›¾ç‰‡è½¬æ¢æœåŠ¡éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

## ğŸš€ éƒ¨ç½²æ–¹å¼é€‰æ‹©

### 1. ä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
- **é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€é«˜å¹¶å‘ã€éœ€è¦å®Œå…¨æ§åˆ¶
- **ä¼˜ç‚¹**: æ€§èƒ½æœ€ä¼˜ã€èµ„æºåˆ©ç”¨ç‡é«˜ã€å®Œå…¨å¯æ§
- **ç¼ºç‚¹**: é…ç½®å¤æ‚ã€ç»´æŠ¤æˆæœ¬é«˜

### 2. Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆæ¨èå¼€å‘/æµ‹è¯•ç¯å¢ƒï¼‰
- **é€‚ç”¨åœºæ™¯**: å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€å¿«é€Ÿéƒ¨ç½²
- **ä¼˜ç‚¹**: éƒ¨ç½²ç®€å•ã€ç¯å¢ƒä¸€è‡´ã€æ˜“äºæ‰©å±•
- **ç¼ºç‚¹**: èµ„æºå¼€é”€è¾ƒå¤§ã€éœ€è¦Dockerç¯å¢ƒ

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### æœåŠ¡å™¨è¦æ±‚
- **CPU**: 2æ ¸ä»¥ä¸Š
- **å†…å­˜**: 4GBä»¥ä¸Š
- **å­˜å‚¨**: 40GBä»¥ä¸Š
- **ç½‘ç»œ**: å…¬ç½‘IPï¼Œå¼€æ”¾80ã€443ã€8000ç«¯å£

### åŸŸåå‡†å¤‡
- å‡†å¤‡ä¸€ä¸ªåŸŸåï¼ˆå¦‚ï¼šapi.example.comï¼‰
- é…ç½®DNSè§£ææŒ‡å‘æœåŠ¡å™¨IP

## ğŸ› ï¸ éƒ¨ç½²æ­¥éª¤

### æ–¹æ¡ˆä¸€ï¼šä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

#### 1. ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# 1. ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨
scp -r ./image-convert-python root@your-server-ip:/tmp/

# 2. è¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip

# 3. è¿›å…¥é¡¹ç›®ç›®å½•
cd /tmp/image-convert-python

# 4. è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
chmod +x deploy/one_click_deploy.sh
./deploy/one_click_deploy.sh
```

#### 2. åˆ†æ­¥éƒ¨ç½²
```bash
# 1. å®‰è£…ç³»ç»Ÿä¾èµ–
chmod +x deploy/install_dependencies.sh
./deploy/install_dependencies.sh

# 2. è®¾ç½®æ•°æ®åº“
chmod +x deploy/setup_database.sh
./deploy/setup_database.sh

# 3. éƒ¨ç½²åº”ç”¨
chmod +x deploy/deploy_app.sh
./deploy/deploy_app.sh

# 4. é…ç½®Nginx
chmod +x deploy/setup_nginx.sh
./deploy/setup_nginx.sh
```

### æ–¹æ¡ˆäºŒï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²

#### 1. å‡†å¤‡Dockerç¯å¢ƒ
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# å®‰è£…Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

#### 2. éƒ¨ç½²åº”ç”¨
```bash
# è¿›å…¥Dockerç›®å½•
cd docker

# è¿è¡Œéƒ¨ç½²è„šæœ¬
chmod +x deploy.sh
./deploy.sh
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®
- **MySQL 8.0**: ä¸»æ•°æ®åº“
- **Redis 7**: ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- **å­—ç¬¦é›†**: utf8mb4

### æœåŠ¡é…ç½®
- **ä¸»æœåŠ¡**: Gunicorn + Uvicorn
- **åå‘ä»£ç†**: Nginx
- **å®šæ—¶ä»»åŠ¡**: æ•°æ®æ¸…ç†å’Œå¤‡ä»½

### å®‰å…¨é…ç½®
- **é˜²ç«å¢™**: åªå¼€æ”¾å¿…è¦ç«¯å£
- **SSLè¯ä¹¦**: æ”¯æŒHTTPS
- **å®‰å…¨å¤´**: é˜²æ­¢å¸¸è§æ”»å‡»
- **æ–‡ä»¶ä¸Šä¼ **: é™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å°

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æœåŠ¡ç›‘æ§
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status image-convert
systemctl status image-convert-scheduler
systemctl status nginx

# æŸ¥çœ‹æ—¥å¿—
journalctl -u image-convert -f
tail -f /var/log/nginx/access.log
```

### æ€§èƒ½ä¼˜åŒ–
- **Gunicorn**: 3ä¸ªå·¥ä½œè¿›ç¨‹
- **Nginx**: å¯ç”¨Gzipå‹ç¼©
- **MySQL**: ä¼˜åŒ–ç¼“å†²æ± å¤§å°
- **Redis**: æŒä¹…åŒ–é…ç½®

### å¤‡ä»½ç­–ç•¥
- **æ•°æ®åº“**: æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
- **æ–‡ä»¶**: å®šæœŸå¤‡ä»½ä¸Šä¼ æ–‡ä»¶
- **é…ç½®**: å¤‡ä»½é…ç½®æ–‡ä»¶

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
journalctl -u image-convert --no-pager

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8000
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u image_user -p image_convert

# æ£€æŸ¥MySQLçŠ¶æ€
systemctl status mysql
```

#### 3. æ–‡ä»¶æƒé™é—®é¢˜
```bash
# è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
chown -R www-data:www-data /var/www/image-convert
chmod -R 755 /var/www/image-convert
```

#### 4. Nginxé…ç½®é”™è¯¯
```bash
# æµ‹è¯•Nginxé…ç½®
nginx -t

# é‡æ–°åŠ è½½é…ç½®
systemctl reload nginx
```

## ğŸ“ˆ æ‰©å±•æ–¹æ¡ˆ

### æ°´å¹³æ‰©å±•
- **è´Ÿè½½å‡è¡¡**: ä½¿ç”¨Nginx upstream
- **æ•°æ®åº“**: ä¸»ä»å¤åˆ¶
- **ç¼“å­˜**: Redisé›†ç¾¤

### å‚ç›´æ‰©å±•
- **æœåŠ¡å™¨**: å¢åŠ CPUå’Œå†…å­˜
- **å­˜å‚¨**: ä½¿ç”¨SSDå­˜å‚¨
- **ç½‘ç»œ**: å¢åŠ å¸¦å®½

## ğŸ” å®‰å…¨å»ºè®®

### 1. ç³»ç»Ÿå®‰å…¨
- å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸
- ä½¿ç”¨å¼ºå¯†ç 
- ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

### 2. åº”ç”¨å®‰å…¨
- å¯ç”¨HTTPS
- é…ç½®é˜²ç«å¢™
- å®šæœŸå¤‡ä»½æ•°æ®

### 3. æ•°æ®å®‰å…¨
- åŠ å¯†æ•æ„Ÿæ•°æ®
- å®šæœŸæ¸…ç†æ—¥å¿—
- ç›‘æ§å¼‚å¸¸è®¿é—®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ—¥å¿—ä½ç½®
- **åº”ç”¨æ—¥å¿—**: `/var/log/gunicorn/`
- **Nginxæ—¥å¿—**: `/var/log/nginx/`
- **ç³»ç»Ÿæ—¥å¿—**: `journalctl -u service-name`

### é…ç½®æ–‡ä»¶ä½ç½®
- **åº”ç”¨é…ç½®**: `/var/www/image-convert/config.py`
- **Nginxé…ç½®**: `/etc/nginx/sites-available/`
- **æœåŠ¡é…ç½®**: `/etc/systemd/system/`

### å¸¸ç”¨å‘½ä»¤
```bash
# é‡å¯æœåŠ¡
systemctl restart image-convert

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status image-convert

# æŸ¥çœ‹æ—¥å¿—
journalctl -u image-convert -f

# æµ‹è¯•é…ç½®
nginx -t

# é‡æ–°åŠ è½½Nginx
systemctl reload nginx
```

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡å®Œæˆ
- [ ] åŸŸåDNSè§£æé…ç½®å®Œæˆ
- [ ] ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆ
- [ ] æ•°æ®åº“é…ç½®å®Œæˆ
- [ ] åº”ç”¨éƒ¨ç½²å®Œæˆ
- [ ] Nginxé…ç½®å®Œæˆ
- [ ] SSLè¯ä¹¦é…ç½®å®Œæˆ
- [ ] é˜²ç«å¢™é…ç½®å®Œæˆ
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å¤‡ä»½ç­–ç•¥è®¾ç½®å®Œæˆ
- [ ] ç›‘æ§é…ç½®å®Œæˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¼ ç»Ÿéƒ¨ç½²ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
# 1. å…‹éš†é¡¹ç›®
git clone your-repo-url
cd image-convert-python

# 2. ä¸€é”®éƒ¨ç½²
chmod +x deploy/one_click_deploy.sh
./deploy/one_click_deploy.sh

# 3. é…ç½®åŸŸå
# ç¼–è¾‘ /etc/nginx/sites-available/your-domain.com
# ä¿®æ”¹ server_name ä¸ºä½ çš„åŸŸå

# 4. ç”³è¯·SSLè¯ä¹¦
certbot --nginx -d your-domain.com
```

### Dockeréƒ¨ç½²ï¼ˆ3åˆ†é’Ÿï¼‰
```bash
# 1. å…‹éš†é¡¹ç›®
git clone your-repo-url
cd image-convert-python

# 2. Dockeréƒ¨ç½²
cd docker
chmod +x deploy.sh
./deploy.sh

# 3. è®¿é—®æœåŠ¡
# http://your-server-ip
```

ç°åœ¨ä½ çš„å›¾ç‰‡è½¬æ¢æœåŠ¡å·²ç»æˆåŠŸéƒ¨ç½²ï¼ğŸ‰
