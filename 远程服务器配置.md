# 🌐 远程服务器配置说明

## 📊 服务器信息

- **MySQL服务器**: 1.94.137.69:3306
  - 用户名: root
  - 密码: 123456
  - 数据库: image_convert_db

- **Redis服务器**: 1.94.137.69:6379
  - 密码: foobared
  - 数据库: 0

## 🚀 快速启动

### 方法一：使用远程启动脚本（推荐）
```bash
python remote_start.py
```

### 方法二：使用通用启动脚本
```bash
# Windows
start.bat

# Linux/Mac
./start.sh
```

### 方法三：手动启动
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 测试连接
python test_connection.py

# 3. 初始化数据库
python init_db.py

# 4. 启动服务
python dev_start.py
```

## 🔧 配置说明

### 数据库配置
```python
# config.py
database_url = "mysql+pymysql://root:123456@1.94.137.69:3306/image_convert_db"
```

### Redis配置
```python
# config.py
redis_host = "1.94.137.69"
redis_port = 6379
redis_database = 0
redis_password = "foobared"
redis_url = "redis://:foobared@1.94.137.69:6379/0"
```

## 🧪 连接测试

### 测试所有连接
```bash
python test_connection.py
```

### 单独测试MySQL
```python
from sqlalchemy import create_engine, text
from config import settings

engine = create_engine(settings.database_url)
with engine.connect() as conn:
    result = conn.execute(text("SELECT VERSION()"))
    print(f"MySQL版本: {result.scalar()}")
```

### 单独测试Redis
```python
from redis_client import get_redis

redis_client = get_redis()
if redis_client.ping():
    print("Redis连接成功")
else:
    print("Redis连接失败")
```

## 🐛 常见问题

### 1. 连接超时
```bash
# 检查网络连接
ping 1.94.137.69

# 检查端口是否开放
telnet 1.94.137.69 3306
telnet 1.94.137.69 6379
```

### 2. 认证失败
- 检查用户名密码是否正确
- 确认服务器允许远程连接
- 检查防火墙设置

### 3. 数据库不存在
```sql
-- 登录MySQL创建数据库
mysql -h 1.94.137.69 -u root -p
CREATE DATABASE image_convert_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 4. 权限问题
```sql
-- 确保用户有远程连接权限
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456';
FLUSH PRIVILEGES;
```

## 🔒 安全建议

### 1. 使用专用用户
```sql
-- 创建专用用户
CREATE USER 'image_user'@'%' IDENTIFIED BY 'strong_password';
GRANT ALL PRIVILEGES ON image_convert_db.* TO 'image_user'@'%';
FLUSH PRIVILEGES;
```

### 2. 限制IP访问
```sql
-- 只允许特定IP访问
CREATE USER 'image_user'@'192.168.1.%' IDENTIFIED BY 'strong_password';
GRANT ALL PRIVILEGES ON image_convert_db.* TO 'image_user'@'192.168.1.%';
FLUSH PRIVILEGES;
```

### 3. 使用SSL连接
```python
# 在config.py中添加SSL配置
database_url = "mysql+pymysql://root:123456@1.94.137.69:3306/image_convert_db?ssl_disabled=false"
```

## 📈 性能优化

### 1. 连接池配置
```python
# 在database.py中配置连接池
engine = create_engine(
    settings.database_url,
    pool_size=20,
    max_overflow=30,
    pool_pre_ping=True,
    pool_recycle=3600
)
```

### 2. Redis连接池
```python
# 在redis_client.py中配置连接池
redis_client = redis.Redis(
    host=settings.redis_host,
    port=settings.redis_port,
    db=settings.redis_database,
    password=settings.redis_password,
    max_connections=20,
    retry_on_timeout=True
)
```

## 🚀 部署建议

### 1. 使用环境变量
创建 `.env` 文件：
```env
DATABASE_URL=mysql+pymysql://root:123456@1.94.137.69:3306/image_convert_db
REDIS_HOST=1.94.137.69
REDIS_PORT=6379
REDIS_PASSWORD=foobared
SECRET_KEY=your-secret-key
```

### 2. 使用Docker
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8000
CMD ["python", "dev_start.py"]
```

### 3. 使用Nginx反向代理
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 📝 监控和日志

### 1. 健康检查
```bash
curl http://localhost:8000/health
```

### 2. 查看日志
```bash
# 查看服务日志
tail -f logs/app.log

# 查看数据库日志
mysql -h 1.94.137.69 -u root -p -e "SHOW PROCESSLIST;"
```

### 3. 性能监控
```python
# 在main.py中添加监控端点
@app.get("/metrics")
async def metrics():
    return {
        "database_status": "connected",
        "redis_status": "connected",
        "uptime": "running"
    }
```

## 🎯 下一步

1. 确保网络连接正常
2. 运行连接测试脚本
3. 初始化数据库
4. 启动服务
5. 访问API文档进行测试

## 📞 技术支持

如果遇到问题，请检查：
1. 网络连接状态
2. 服务器运行状态
3. 防火墙设置
4. 用户权限配置
5. 数据库和Redis服务状态
