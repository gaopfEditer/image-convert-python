# 图片压缩接口说明

## 接口地址
`POST /api/image/compress`

## 功能描述
专门用于图片压缩的公开接口，不需要认证，支持质量调整和尺寸调整。

## 请求参数
- `file` (File, 必需): 要压缩的图片文件
- `quality` (int, 可选): 压缩质量，1-100，默认80
- `maxWidth` (int, 可选): 最大宽度，0表示不限制
- `maxHeight` (int, 可选): 最大高度，0表示不限制
- `resize_width` (int, 可选): 调整宽度（备用参数）
- `resize_height` (int, 可选): 调整高度（备用参数）

## 响应格式
```json
{
  "success": true,
  "message": "压缩成功",
  "file_url": "/static/converted/xxx_converted.jpeg",
  "filename": "compressed_xxx.jpg",
  "original_size": 10274,
  "compressed_size": 4092,
  "compression_ratio": 60.17,
  "quality": 80,
  "original_dimensions": {
    "width": 800,
    "height": 600
  },
  "final_dimensions": {
    "width": 800,
    "height": 600
  },
  "format": "JPG",
  "size_changed": true,
  "dimensions_changed": false
}
```

## 特性
1. **智能尺寸处理**: 如果设置的尺寸比原图大，会保持原图尺寸
2. **格式优化**: PNG格式在质量<90时会自动转换为JPEG以获得更好的压缩效果
3. **参数优先级**: `maxWidth`/`maxHeight` 优先于 `resize_width`/`resize_height`
4. **空参数处理**: 当参数为0或空时，保持原图尺寸
5. **公开接口**: 不需要认证，不记录到数据库

## 使用示例

### 只设置质量
```bash
curl -X POST "http://localhost:8000/api/image/compress" \
  -F "file=@image.jpg" \
  -F "quality=80"
```

### 设置质量和尺寸
```bash
curl -X POST "http://localhost:8000/api/image/compress" \
  -F "file=@image.jpg" \
  -F "quality=70" \
  -F "maxWidth=400" \
  -F "maxHeight=300"
```

### 只设置宽度（高度自适应）
```bash
curl -X POST "http://localhost:8000/api/image/compress" \
  -F "file=@image.jpg" \
  -F "quality=85" \
  -F "maxWidth=500"
```

## 定时任务
系统包含定时任务，每天凌晨12点清理匿名用户的转换记录（7天前的记录），每周日凌晨2点清理所有超过30天的记录。

## 启动方式
```bash
# 普通启动
python simple_start.py

# 带定时任务启动
python start_with_scheduler.py
```
