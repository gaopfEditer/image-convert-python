# ğŸ—ï¸ å›¾ç‰‡å¤„ç†æœåŠ¡æ¶æ„é‡æ„æ–¹æ¡ˆ

## ğŸ“ ç›®æ ‡ç›®å½•ç»“æ„

```
image-convert-python/
â”œâ”€â”€ framework/                 # HTTPæ¡†æ¶å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ fastapi_app.py        # FastAPIåº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ middleware/           # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ cors.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â””â”€â”€ logging.py
â”‚   â”œâ”€â”€ routes/               # è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ image.py
â”‚   â”‚   â”œâ”€â”€ payment.py
â”‚   â”‚   â””â”€â”€ wechat.py
â”‚   â””â”€â”€ schemas/              # APIæ¨¡å‹
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ auth.py
â”‚       â”œâ”€â”€ image.py
â”‚       â”œâ”€â”€ payment.py
â”‚       â””â”€â”€ common.py
â”œâ”€â”€ business/                 # æ ¸å¿ƒä¸šåŠ¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ image_conversion/     # å›¾ç‰‡è½¬æ¢ä¸šåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ service.py        # å›¾ç‰‡è½¬æ¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ orchestrator.py   # æµç¨‹ç¼–æ’
â”‚   â”‚   â””â”€â”€ models.py         # ä¸šåŠ¡æ¨¡å‹
â”‚   â”œâ”€â”€ user_management/      # ç”¨æˆ·ç®¡ç†ä¸šåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â””â”€â”€ models.py
â”‚   â”œâ”€â”€ payment/              # æ”¯ä»˜ä¸šåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚   â”œâ”€â”€ alipay_service.py
â”‚   â”‚   â”œâ”€â”€ wechat_service.py
â”‚   â”‚   â””â”€â”€ models.py
â”‚   â””â”€â”€ permission/           # æƒé™ç®¡ç†ä¸šåŠ¡
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ service.py
â”‚       â””â”€â”€ models.py
â”œâ”€â”€ tool/                     # å·¥å…·å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ image/                # å›¾ç‰‡å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ processor.py      # Sharpå°è£…
â”‚   â”‚   â”œâ”€â”€ converter.py      # æ ¼å¼è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ compressor.py     # å‹ç¼©å·¥å…·
â”‚   â”‚   â”œâ”€â”€ resizer.py        # å°ºå¯¸è°ƒæ•´
â”‚   â”‚   â””â”€â”€ watermark.py      # æ°´å°å·¥å…·
â”‚   â”œâ”€â”€ file/                 # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ manager.py        # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ validator.py      # æ–‡ä»¶éªŒè¯
â”‚   â”‚   â””â”€â”€ utils.py          # æ–‡ä»¶å·¥å…·
â”‚   â”œâ”€â”€ crypto/               # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ password.py       # å¯†ç åŠ å¯†
â”‚   â”‚   â””â”€â”€ jwt.py            # JWTå·¥å…·
â”‚   â””â”€â”€ utils/                # é€šç”¨å·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ logger.py         # æ—¥å¿—å·¥å…·
â”‚       â”œâ”€â”€ metrics.py        # æŒ‡æ ‡æ”¶é›†
â”‚       â””â”€â”€ helpers.py        # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ infra/                    # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database/             # æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ connection.py     # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ models.py         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ migrations/       # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ repositories/     # æ•°æ®è®¿é—®å±‚
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ user_repo.py
â”‚   â”‚       â”œâ”€â”€ image_repo.py
â”‚   â”‚       â””â”€â”€ payment_repo.py
â”‚   â”œâ”€â”€ cache/                # ç¼“å­˜
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ redis_client.py   # Rediså®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ cache_service.py  # ç¼“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ storage/              # å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ local_storage.py  # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ oss_storage.py    # é˜¿é‡Œäº‘OSS
â”‚   â”‚   â””â”€â”€ storage_factory.py # å­˜å‚¨å·¥å‚
â”‚   â””â”€â”€ external/             # å¤–éƒ¨æœåŠ¡
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ alipay_client.py  # æ”¯ä»˜å®å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ wechat_client.py  # å¾®ä¿¡å®¢æˆ·ç«¯
â”‚       â””â”€â”€ notification.py   # é€šçŸ¥æœåŠ¡
â”œâ”€â”€ domain/                   # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ entities/             # å®ä½“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ image.py
â”‚   â”‚   â”œâ”€â”€ conversion.py
â”‚   â”‚   â””â”€â”€ payment.py
â”‚   â”œâ”€â”€ value_objects/        # å€¼å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ file_info.py
â”‚   â”‚   â”œâ”€â”€ image_metadata.py
â”‚   â”‚   â””â”€â”€ processing_params.py
â”‚   â”œâ”€â”€ services/             # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ image_processing.py
â”‚   â”‚   â””â”€â”€ permission_checker.py
â”‚   â””â”€â”€ repositories/         # ä»“å‚¨æ¥å£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ user_repository.py
â”‚       â”œâ”€â”€ image_repository.py
â”‚       â””â”€â”€ payment_repository.py
â”œâ”€â”€ types/                    # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ common.py             # é€šç”¨ç±»å‹
â”‚   â”œâ”€â”€ image.py              # å›¾ç‰‡ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ user.py               # ç”¨æˆ·ç›¸å…³ç±»å‹
â”‚   â””â”€â”€ api.py                # APIç±»å‹
â”œâ”€â”€ config/                   # é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py           # é…ç½®è®¾ç½®
â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ redis.py              # Redisé…ç½®
â”‚   â””â”€â”€ storage.py            # å­˜å‚¨é…ç½®
â”œâ”€â”€ tests/                    # æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ unit/                 # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/          # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/                  # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ scripts/                  # è„šæœ¬
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ migrate.py            # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ seed.py               # æ•°æ®å¡«å……
â”‚   â””â”€â”€ cleanup.py            # æ¸…ç†è„šæœ¬
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                  # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/         # æ¶æ„æ–‡æ¡£
â”‚   â””â”€â”€ deployment/           # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ main.py                   # åº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt          # ä¾èµ–
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## ğŸ¯ åˆ†å±‚èŒè´£

### 1. Framework Layer (æ¡†æ¶å±‚)
**èŒè´£**: HTTPæ¡†æ¶ç»†èŠ‚å¤„ç†
**ç‰¹ç‚¹**: å¯æ›¿æ¢ï¼Œæ¡†æ¶æ— å…³
**åŒ…å«**:
- FastAPIåº”ç”¨é…ç½®
- ä¸­é—´ä»¶ (CORS, è®¤è¯, æ—¥å¿—)
- è·¯ç”±å®šä¹‰
- APIæ¨¡å‹å®šä¹‰
- è¯·æ±‚/å“åº”å¤„ç†

### 2. Business Layer (ä¸šåŠ¡å±‚)
**èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
**ç‰¹ç‚¹**: ä¸å¯æ›¿æ¢ï¼Œä¸šåŠ¡æ ¸å¿ƒ
**åŒ…å«**:
- å›¾ç‰‡è½¬æ¢ä¸šåŠ¡æµç¨‹
- ç”¨æˆ·ç®¡ç†ä¸šåŠ¡
- æ”¯ä»˜ä¸šåŠ¡é€»è¾‘
- æƒé™ç®¡ç†
- ä¸šåŠ¡è§„åˆ™å’Œæµç¨‹ç¼–æ’

### 3. Tool Layer (å·¥å…·å±‚)
**èŒè´£**: æ— çŠ¶æ€å·¥å…·å‡½æ•°
**ç‰¹ç‚¹**: å¯å¤ç”¨ã€å¯æµ‹è¯•
**åŒ…å«**:
- å›¾ç‰‡å¤„ç†å·¥å…· (Sharpå°è£…)
- æ–‡ä»¶æ“ä½œå·¥å…·
- åŠ å¯†å·¥å…·
- é€šç”¨å·¥å…·å‡½æ•°

### 4. Infra Layer (åŸºç¡€è®¾æ–½å±‚)
**èŒè´£**: å¤–éƒ¨æœåŠ¡é€‚é…
**ç‰¹ç‚¹**: å¯æ’æ‹”ï¼Œæ¢äº‘å‚å•†ä¸å½±å“ä¸šåŠ¡
**åŒ…å«**:
- æ•°æ®åº“è¿æ¥å’Œæ“ä½œ
- ç¼“å­˜æœåŠ¡
- å­˜å‚¨æœåŠ¡
- å¤–éƒ¨APIå®¢æˆ·ç«¯

### 5. Domain Layer (é¢†åŸŸå±‚)
**èŒè´£**: ä¸šåŠ¡å®ä½“å’Œè§„åˆ™
**ç‰¹ç‚¹**: é¢†åŸŸé©±åŠ¨è®¾è®¡
**åŒ…å«**:
- ä¸šåŠ¡å®ä½“
- å€¼å¯¹è±¡
- é¢†åŸŸæœåŠ¡
- ä»“å‚¨æ¥å£

### 6. Types Layer (ç±»å‹å±‚)
**èŒè´£**: å…¨å±€ç±»å‹å®šä¹‰
**ç‰¹ç‚¹**: ç±»å‹å®‰å…¨
**åŒ…å«**:
- é€šç”¨ç±»å‹å®šä¹‰
- ä¸šåŠ¡ç±»å‹å®šä¹‰
- APIç±»å‹å®šä¹‰

## ğŸ”„ ä¾èµ–å…³ç³»

```
Framework Layer
    â†“ ä¾èµ–
Business Layer
    â†“ ä¾èµ–
Domain Layer
    â†‘ å®ç°
Infra Layer
    â†‘ ä½¿ç”¨
Tool Layer
```

## ğŸ“‹ é‡æ„æ­¥éª¤

### é˜¶æ®µ1: åˆ›å»ºç›®å½•ç»“æ„
1. åˆ›å»ºæ‰€æœ‰ç›®å½•
2. ç§»åŠ¨ç°æœ‰æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•
3. æ›´æ–°å¯¼å…¥è·¯å¾„

### é˜¶æ®µ2: é‡æ„å·¥å…·å±‚
1. æå–å›¾ç‰‡å¤„ç†å·¥å…·
2. æå–æ–‡ä»¶æ“ä½œå·¥å…·
3. æå–åŠ å¯†å·¥å…·
4. åˆ›å»ºå·¥å…·æ¥å£

### é˜¶æ®µ3: é‡æ„åŸºç¡€è®¾æ–½å±‚
1. é‡æ„æ•°æ®åº“å±‚
2. é‡æ„ç¼“å­˜å±‚
3. é‡æ„å­˜å‚¨å±‚
4. åˆ›å»ºå¤–éƒ¨æœåŠ¡é€‚é…å™¨

### é˜¶æ®µ4: é‡æ„ä¸šåŠ¡å±‚
1. æå–ä¸šåŠ¡æœåŠ¡
2. åˆ›å»ºä¸šåŠ¡æµç¨‹ç¼–æ’
3. å®ç°ä¸šåŠ¡è§„åˆ™
4. åˆ›å»ºä¸šåŠ¡æ¨¡å‹

### é˜¶æ®µ5: é‡æ„æ¡†æ¶å±‚
1. é‡æ„è·¯ç”±
2. é‡æ„ä¸­é—´ä»¶
3. é‡æ„APIæ¨¡å‹
4. ä¼˜åŒ–è¯·æ±‚å¤„ç†

### é˜¶æ®µ6: å®Œå–„é¢†åŸŸå±‚
1. å®šä¹‰ä¸šåŠ¡å®ä½“
2. åˆ›å»ºå€¼å¯¹è±¡
3. å®ç°é¢†åŸŸæœåŠ¡
4. å®šä¹‰ä»“å‚¨æ¥å£

## ğŸ¯ é‡æ„åçš„ä¼˜åŠ¿

1. **æ¸…æ™°åˆ†å±‚**: æ¯å±‚èŒè´£æ˜ç¡®ï¼Œæ˜“äºç†è§£
2. **é«˜å†…èš**: ç›¸å…³åŠŸèƒ½èšåˆåœ¨ä¸€èµ·
3. **ä½è€¦åˆ**: å±‚é—´ä¾èµ–æ¸…æ™°ï¼Œæ˜“äºæ›¿æ¢
4. **å¯æµ‹è¯•**: æ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
5. **å¯æ‰©å±•**: æ–°åŠŸèƒ½å¯ä»¥æŒ‰å±‚æ·»åŠ 
6. **å¯ç»´æŠ¤**: ä¿®æ”¹å½±å“èŒƒå›´å¯æ§
7. **å¯å¤ç”¨**: å·¥å…·å±‚å’Œé¢†åŸŸå±‚å¯å¤ç”¨

è¿™ä¸ªæ¶æ„é‡æ„æ–¹æ¡ˆå°†è®©ä»£ç æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•ã€‚
