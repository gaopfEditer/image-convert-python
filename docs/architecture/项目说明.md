# ğŸ¯ å›¾ç‰‡è½¬æ¢æœåŠ¡ - å®Œæ•´é¡¹ç›®è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºFastAPIçš„å›¾ç‰‡æ ¼å¼è½¬æ¢æœåŠ¡ï¼Œæ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼è½¬æ¢ï¼ŒåŒ…å«å®Œæ•´çš„ä¼šå‘˜ç³»ç»Ÿã€æƒé™ç®¡ç†å’Œæ”¯ä»˜åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

**Windowsç”¨æˆ·ï¼š**
```cmd
# åŒå‡»è¿è¡Œ
start.bat

# æˆ–å‘½ä»¤è¡Œè¿è¡Œ
start.bat
```

**Linux/Macç”¨æˆ·ï¼š**
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# è¿è¡Œè„šæœ¬
./start.sh
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

1. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

2. **é…ç½®æ•°æ®åº“**
   - å®‰è£…PostgreSQL
   - æ‰§è¡Œ `database_init.sql` åˆ›å»ºæ•°æ®åº“
   - æˆ–è¿è¡Œ `python init_db.py` è‡ªåŠ¨åˆå§‹åŒ–

3. **å¯åŠ¨æœåŠ¡**
   ```bash
   python dev_start.py
   ```

## ğŸ“š APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹APIæ–‡æ¡£ï¼š

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **APIæ ¹è·¯å¾„**: http://localhost:8000/

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### ä½¿ç”¨MySQLï¼ˆæ¨èï¼‰

1. **å®‰è£…MySQL**
   ```bash
   # Windows
   # ä¸‹è½½MySQLå®‰è£…åŒ…ï¼šhttps://dev.mysql.com/downloads/mysql/
   
   # macOS
   brew install mysql
   
   # Ubuntu
   sudo apt-get install mysql-server
   ```

2. **åˆ›å»ºæ•°æ®åº“**
   ```sql
   -- ç™»å½•MySQL
   mysql -u root -p
   
   -- æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
   source database_init_mysql.sql
   ```

3. **ä¿®æ”¹é…ç½®**
   ç¼–è¾‘ `config.py` ä¸­çš„æ•°æ®åº“è¿æ¥ï¼š
   ```python
   database_url = "mysql+pymysql://root:your_password@localhost:3306/image_convert_db"
   ```

### ä½¿ç”¨SQLiteï¼ˆå¼€å‘æµ‹è¯•ï¼‰

ä¿®æ”¹ `config.py`ï¼š
```python
database_url = "sqlite:///./image_convert.db"
```

## ğŸ”§ é¡¹ç›®ç»“æ„

```
image-convert-python/
â”œâ”€â”€ ğŸ“ alembic/                 # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ ğŸ“ routers/                 # APIè·¯ç”±
â”‚   â”œâ”€â”€ auth.py                # è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ image.py               # å›¾ç‰‡è½¬æ¢
â”‚   â””â”€â”€ payment.py             # æ”¯ä»˜ç›¸å…³
â”œâ”€â”€ ğŸ“ services/               # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ user_service.py        # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ image_service.py       # å›¾ç‰‡è½¬æ¢æœåŠ¡
â”‚   â”œâ”€â”€ payment_service.py     # æ”¯ä»˜æœåŠ¡
â”‚   â””â”€â”€ permission_service.py  # æƒé™æœåŠ¡
â”œâ”€â”€ ğŸ“ uploads/                # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ ğŸ“„ main.py                 # ä¸»åº”ç”¨
â”œâ”€â”€ ğŸ“„ config.py               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ database.py             # æ•°æ®åº“é…ç½®
â”œâ”€â”€ ğŸ“„ models.py               # æ•°æ®æ¨¡å‹
â”œâ”€â”€ ğŸ“„ schemas.py              # APIæ¨¡å‹
â”œâ”€â”€ ğŸ“„ auth.py                 # è®¤è¯é€»è¾‘
â”œâ”€â”€ ğŸ“„ dev_start.py            # å¼€å‘å¯åŠ¨è„šæœ¬
â”œâ”€â”€ ğŸ“„ init_db.py              # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ ğŸ“„ database_init.sql       # æ•°æ®åº“SQLè„šæœ¬
â”œâ”€â”€ ğŸ“„ start.bat               # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ ğŸ“„ start.sh                # Linux/Macå¯åŠ¨è„šæœ¬
â””â”€â”€ ğŸ“„ requirements.txt        # ä¾èµ–åˆ—è¡¨
```

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. å›¾ç‰‡è½¬æ¢
- âœ… æ”¯æŒæ ¼å¼ï¼šJPEGã€PNGã€WebPã€BMPã€TIFFã€GIF
- âœ… è´¨é‡è°ƒæ•´ï¼š1-100
- âœ… å°ºå¯¸è°ƒæ•´ï¼šå®½åº¦ã€é«˜åº¦
- âœ… æ°´å°æ·»åŠ ï¼šæ–‡å­—æ°´å°
- âœ… æ‰¹é‡è½¬æ¢ï¼šVIPåŠŸèƒ½

### 2. ç”¨æˆ·ç³»ç»Ÿ
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- âœ… JWTèº«ä»½éªŒè¯
- âœ… å¯†ç åŠ å¯†å­˜å‚¨
- âœ… ç”¨æˆ·ä¿¡æ¯ç®¡ç†

### 3. ä¼šå‘˜ç³»ç»Ÿ
- âœ… å…è´¹ç”¨æˆ·ï¼šæ¯æ—¥5æ¬¡è½¬æ¢
- âœ… VIPä¼šå‘˜ï¼šæ¯æ—¥100æ¬¡è½¬æ¢
- âœ… SVIPä¼šå‘˜ï¼šæ¯æ—¥1000æ¬¡è½¬æ¢
- âœ… æƒç›Šç®¡ç†

### 4. æ”¯ä»˜ç³»ç»Ÿ
- âœ… æ”¯ä»˜å®æ”¯ä»˜
- âœ… å¾®ä¿¡æ”¯ä»˜
- âœ… æ”¯ä»˜å›è°ƒå¤„ç†
- âœ… è®¢å•ç®¡ç†

### 5. æƒé™ç®¡ç†
- âœ… åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- âœ… ä½¿ç”¨æ¬¡æ•°é™åˆ¶
- âœ… åŠŸèƒ½æƒé™æ§åˆ¶
- âœ… ä½¿ç”¨ç»Ÿè®¡

## ğŸ”‘ APIæ¥å£

### è®¤è¯æ¥å£
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/me` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/auth/me` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

### å›¾ç‰‡è½¬æ¢æ¥å£
- `GET /api/image/formats` - è·å–æ”¯æŒæ ¼å¼
- `POST /api/image/convert` - è½¬æ¢å›¾ç‰‡
- `POST /api/image/info` - è·å–å›¾ç‰‡ä¿¡æ¯
- `GET /api/image/usage` - ä½¿ç”¨ç»Ÿè®¡
- `GET /api/image/records` - è½¬æ¢è®°å½•

### æ”¯ä»˜æ¥å£
- `POST /api/payment/create` - åˆ›å»ºæ”¯ä»˜
- `POST /api/payment/alipay/create` - æ”¯ä»˜å®æ”¯ä»˜
- `POST /api/payment/wechat/create` - å¾®ä¿¡æ”¯ä»˜
- `GET /api/payment/orders` - æ”¯ä»˜è®°å½•
- `GET /api/payment/upgrade-options` - å‡çº§é€‰é¡¹

## ğŸ§ª æµ‹è¯•API

### 1. æ³¨å†Œç”¨æˆ·
```bash
curl -X POST "http://localhost:8000/api/auth/register" \
     -H "Content-Type: application/json" \
     -d '{
       "username": "testuser",
       "email": "test@example.com",
       "password": "testpassword"
     }'
```

### 2. ç”¨æˆ·ç™»å½•
```bash
curl -X POST "http://localhost:8000/api/auth/login" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=testuser&password=testpassword"
```

### 3. è·å–æ”¯æŒçš„æ ¼å¼
```bash
curl -X GET "http://localhost:8000/api/image/formats"
```

### 4. è½¬æ¢å›¾ç‰‡ï¼ˆéœ€è¦ç™»å½•ï¼‰
```bash
curl -X POST "http://localhost:8000/api/image/convert" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -F "file=@image.jpg" \
     -F "target_format=PNG" \
     -F "quality=95"
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
DATABASE_URL=postgresql://postgres:password@localhost:5432/image_convert_db
SECRET_KEY=your-secret-key
ALIPAY_APP_ID=your-alipay-app-id
WECHAT_APP_ID=your-wechat-app-id
```

### æ”¯ä»˜é…ç½®
- **æ”¯ä»˜å®**ï¼šéœ€è¦é…ç½®åº”ç”¨IDã€ç§é’¥ã€å…¬é’¥
- **å¾®ä¿¡æ”¯ä»˜**ï¼šéœ€è¦é…ç½®åº”ç”¨IDã€å•†æˆ·å·ã€APIå¯†é’¥

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥PostgreSQLæœåŠ¡æ˜¯å¦å¯åŠ¨
- ç¡®è®¤æ•°æ®åº“è¿æ¥å‚æ•°æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8000  # Windows
lsof -i :8000                 # Linux/Mac

# ä¿®æ”¹ç«¯å£
uvicorn main:app --port 8001
```

### 3. ä¾èµ–å®‰è£…å¤±è´¥
```bash
# å‡çº§pip
python -m pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

### 4. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
- æ£€æŸ¥ `uploads` ç›®å½•æƒé™
- ç¡®è®¤æ–‡ä»¶å¤§å°ä¸è¶…è¿‡é™åˆ¶
- æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å¼€å‘ç¯å¢ƒ
```bash
python dev_start.py
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨Gunicorn
pip install gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker

# ä½¿ç”¨Docker
docker build -t image-convert-api .
docker run -p 8000:8000 image-convert-api
```

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `models.py` ä¸­å®šä¹‰æ•°æ®æ¨¡å‹
2. åœ¨ `schemas.py` ä¸­å®šä¹‰APIæ¨¡å‹
3. åœ¨ `services/` ä¸­å®ç°ä¸šåŠ¡é€»è¾‘
4. åœ¨ `routers/` ä¸­åˆ›å»ºAPIè·¯ç”±
5. åœ¨ `main.py` ä¸­æ³¨å†Œè·¯ç”±

### æ•°æ®åº“è¿ç§»
```bash
# åˆ›å»ºè¿ç§»
alembic revision --autogenerate -m "æè¿°"

# æ‰§è¡Œè¿ç§»
alembic upgrade head
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- é‚®ç®±: your-email@example.com
- GitHub: https://github.com/your-username/image-convert-python
