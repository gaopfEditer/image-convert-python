# 🎨 前端集成指南

## 📋 概述

本指南将帮助您在前端项目中集成图片转换服务的认证系统，支持Google账号登录（通过Auth0）。

## 🚀 快速开始

### 1. 基础HTML集成

```html
<!DOCTYPE html>
<html>
<head>
    <title>我的应用</title>
    <script src="https://bz.e.gaopf.top/static/js/auth.js"></script>
</head>
<body>
    <div id="app">
        <div id="loginSection" style="display: none;">
            <h2>请先登录</h2>
            <button onclick="login()">Google登录</button>
        </div>
        
        <div id="mainApp" style="display: none;">
            <h2>欢迎，<span id="username"></span>！</h2>
            <button onclick="logout()">登出</button>
        </div>
    </div>

    <script>
        // 检查登录状态
        function checkLogin() {
            if (window.authService.isLoggedIn()) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('username').textContent = window.authService.getCurrentUser().username;
            } else {
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
        }
        
        // 登录
        async function login() {
            try {
                await window.authService.auth0Login();
            } catch (error) {
                alert('登录失败: ' + error.message);
            }
        }
        
        // 登出
        function logout() {
            window.authService.logout();
        }
        
        // 页面加载时检查登录状态
        document.addEventListener('DOMContentLoaded', checkLogin);
    </script>
</body>
</html>
```

### 2. React集成

```jsx
import React, { useState, useEffect } from 'react';

function App() {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        // 检查登录状态
        if (window.authService.isLoggedIn()) {
            setUser(window.authService.getCurrentUser());
        }
        setLoading(false);
    }, []);

    const handleLogin = async () => {
        try {
            await window.authService.auth0Login();
        } catch (error) {
            console.error('登录失败:', error);
        }
    };

    const handleLogout = () => {
        window.authService.logout();
        setUser(null);
    };

    if (loading) {
        return <div>加载中...</div>;
    }

    return (
        <div>
            {user ? (
                <div>
                    <h2>欢迎，{user.username}！</h2>
                    <button onClick={handleLogout}>登出</button>
                </div>
            ) : (
                <div>
                    <h2>请先登录</h2>
                    <button onClick={handleLogin}>Google登录</button>
                </div>
            )}
        </div>
    );
}

export default App;
```

### 3. Vue.js集成

```vue
<template>
    <div>
        <div v-if="!user">
            <h2>请先登录</h2>
            <button @click="login">Google登录</button>
        </div>
        <div v-else>
            <h2>欢迎，{{ user.username }}！</h2>
            <button @click="logout">登出</button>
        </div>
    </div>
</template>

<script>
export default {
    data() {
        return {
            user: null
        };
    },
    mounted() {
        this.checkLogin();
    },
    methods: {
        checkLogin() {
            if (window.authService.isLoggedIn()) {
                this.user = window.authService.getCurrentUser();
            }
        },
        async login() {
            try {
                await window.authService.auth0Login();
            } catch (error) {
                console.error('登录失败:', error);
            }
        },
        logout() {
            window.authService.logout();
            this.user = null;
        }
    }
};
</script>
```

## 🔧 API使用

### 1. 认证服务方法

```javascript
// 检查登录状态
const isLoggedIn = window.authService.isLoggedIn();

// 获取当前用户
const user = window.authService.getCurrentUser();

// 获取访问令牌
const token = window.authService.getToken();

// 发起登录
await window.authService.auth0Login();      // Auth0登录（推荐）
await window.authService.googleLogin();     // Google直接登录
await window.authService.wechatLogin();     // 微信登录

// 登出
window.authService.logout();

// 带认证的API调用
const response = await window.authService.authenticatedRequest('/api/some-endpoint', {
    method: 'POST',
    body: JSON.stringify({ data: 'example' })
});
```

### 2. 用户信息结构

```javascript
const user = {
    id: "123",
    username: "john_doe",
    email: "john@example.com",
    loginMethod: "Auth0",
    // 其他用户信息...
};
```

## 🌐 页面路由

### 1. 登录页面
- **URL**: `https://bz.e.gaopf.top/login`
- **功能**: 智能登录页面，根据用户IP推荐登录方式

### 2. 登录成功页面
- **URL**: `https://bz.e.gaopf.top/login/success`
- **参数**: 
  - `token`: 访问令牌
  - `user_id`: 用户ID
  - `username`: 用户名
  - `email`: 邮箱
  - `login_method`: 登录方式

### 3. 演示页面
- **URL**: `https://bz.e.gaopf.top/demo`
- **功能**: 认证功能演示和测试

## 🔄 登录流程

### 1. 用户点击登录
```javascript
// 用户点击登录按钮
await window.authService.auth0Login();
```

### 2. 跳转到Auth0
- 用户被重定向到Auth0登录页面
- 用户选择Google账号登录
- 用户授权应用访问Google账号信息

### 3. 回调处理
- Auth0处理Google登录
- 获取用户信息
- 重定向回应用：`/login/success?token=xxx&user_id=xxx&...`

### 4. 保存用户信息
```javascript
// 自动处理登录成功
if (window.authService.handleLoginSuccess()) {
    console.log('登录成功！');
    // 用户信息已保存到localStorage
}
```

## 🛡️ 安全考虑

### 1. 令牌存储
- 访问令牌存储在`localStorage`中
- 令牌会自动添加到API请求的Authorization头中
- 令牌过期时会自动登出用户

### 2. 跨域请求
- 确保API服务器配置了正确的CORS设置
- 支持预检请求（OPTIONS）

### 3. HTTPS
- 生产环境必须使用HTTPS
- Auth0回调URL必须使用HTTPS

## 📱 移动端支持

### 1. 响应式设计
```css
@media (max-width: 768px) {
    .login-container {
        width: 95%;
        padding: 20px;
    }
    
    .login-options {
        flex-direction: column;
        gap: 10px;
    }
}
```

### 2. 移动端登录
- 支持移动端浏览器
- 支持微信内置浏览器
- 支持各种移动设备

## 🔧 配置选项

### 1. 自定义登录页面
```javascript
// 自定义登录按钮样式
const loginBtn = document.getElementById('loginBtn');
loginBtn.addEventListener('click', async () => {
    try {
        await window.authService.auth0Login();
    } catch (error) {
        // 处理登录错误
        console.error('登录失败:', error);
    }
});
```

### 2. 自定义回调处理
```javascript
// 监听登录成功事件
window.addEventListener('loginSuccess', (event) => {
    console.log('登录成功:', event.detail.user);
    // 自定义处理逻辑
});

// 监听登出事件
window.addEventListener('logout', () => {
    console.log('用户已登出');
    // 自定义处理逻辑
});
```

## 🐛 故障排除

### 1. 常见问题

**问题**: 登录后页面没有跳转
**解决**: 检查Auth0回调URL配置是否正确

**问题**: 令牌验证失败
**解决**: 检查API服务器是否正常运行

**问题**: CORS错误
**解决**: 检查API服务器CORS配置

### 2. 调试方法

```javascript
// 开启调试模式
localStorage.setItem('debug', 'true');

// 查看用户信息
console.log('用户信息:', window.authService.getCurrentUser());

// 查看令牌
console.log('访问令牌:', window.authService.getToken());

// 测试API调用
window.authService.authenticatedRequest('/api/auth/me')
    .then(response => response.json())
    .then(data => console.log('API响应:', data))
    .catch(error => console.error('API错误:', error));
```

## 📚 更多资源

- [Auth0文档](https://auth0.com/docs)
- [FastAPI文档](https://fastapi.tiangolo.com/)
- [API文档](https://bz.e.gaopf.top/api/docs)

## 🆘 技术支持

如果您在使用过程中遇到问题，请：

1. 查看浏览器控制台错误信息
2. 检查网络请求状态
3. 确认配置是否正确
4. 联系技术支持团队
