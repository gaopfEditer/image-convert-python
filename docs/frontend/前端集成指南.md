# ğŸ¨ å‰ç«¯é›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨å‰ç«¯é¡¹ç›®ä¸­é›†æˆå›¾ç‰‡è½¬æ¢æœåŠ¡çš„è®¤è¯ç³»ç»Ÿï¼Œæ”¯æŒGoogleè´¦å·ç™»å½•ï¼ˆé€šè¿‡Auth0ï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€HTMLé›†æˆ

```html
<!DOCTYPE html>
<html>
<head>
    <title>æˆ‘çš„åº”ç”¨</title>
    <script src="https://bz.e.gaopf.top/static/js/auth.js"></script>
</head>
<body>
    <div id="app">
        <div id="loginSection" style="display: none;">
            <h2>è¯·å…ˆç™»å½•</h2>
            <button onclick="login()">Googleç™»å½•</button>
        </div>
        
        <div id="mainApp" style="display: none;">
            <h2>æ¬¢è¿ï¼Œ<span id="username"></span>ï¼</h2>
            <button onclick="logout()">ç™»å‡º</button>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLogin() {
            if (window.authService.isLoggedIn()) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('username').textContent = window.authService.getCurrentUser().username;
            } else {
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
        }
        
        // ç™»å½•
        async function login() {
            try {
                await window.authService.auth0Login();
            } catch (error) {
                alert('ç™»å½•å¤±è´¥: ' + error.message);
            }
        }
        
        // ç™»å‡º
        function logout() {
            window.authService.logout();
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        document.addEventListener('DOMContentLoaded', checkLogin);
    </script>
</body>
</html>
```

### 2. Reacté›†æˆ

```jsx
import React, { useState, useEffect } from 'react';

function App() {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (window.authService.isLoggedIn()) {
            setUser(window.authService.getCurrentUser());
        }
        setLoading(false);
    }, []);

    const handleLogin = async () => {
        try {
            await window.authService.auth0Login();
        } catch (error) {
            console.error('ç™»å½•å¤±è´¥:', error);
        }
    };

    const handleLogout = () => {
        window.authService.logout();
        setUser(null);
    };

    if (loading) {
        return <div>åŠ è½½ä¸­...</div>;
    }

    return (
        <div>
            {user ? (
                <div>
                    <h2>æ¬¢è¿ï¼Œ{user.username}ï¼</h2>
                    <button onClick={handleLogout}>ç™»å‡º</button>
                </div>
            ) : (
                <div>
                    <h2>è¯·å…ˆç™»å½•</h2>
                    <button onClick={handleLogin}>Googleç™»å½•</button>
                </div>
            )}
        </div>
    );
}

export default App;
```

### 3. Vue.jsé›†æˆ

```vue
<template>
    <div>
        <div v-if="!user">
            <h2>è¯·å…ˆç™»å½•</h2>
            <button @click="login">Googleç™»å½•</button>
        </div>
        <div v-else>
            <h2>æ¬¢è¿ï¼Œ{{ user.username }}ï¼</h2>
            <button @click="logout">ç™»å‡º</button>
        </div>
    </div>
</template>

<script>
export default {
    data() {
        return {
            user: null
        };
    },
    mounted() {
        this.checkLogin();
    },
    methods: {
        checkLogin() {
            if (window.authService.isLoggedIn()) {
                this.user = window.authService.getCurrentUser();
            }
        },
        async login() {
            try {
                await window.authService.auth0Login();
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
            }
        },
        logout() {
            window.authService.logout();
            this.user = null;
        }
    }
};
</script>
```

## ğŸ”§ APIä½¿ç”¨

### 1. è®¤è¯æœåŠ¡æ–¹æ³•

```javascript
// æ£€æŸ¥ç™»å½•çŠ¶æ€
const isLoggedIn = window.authService.isLoggedIn();

// è·å–å½“å‰ç”¨æˆ·
const user = window.authService.getCurrentUser();

// è·å–è®¿é—®ä»¤ç‰Œ
const token = window.authService.getToken();

// å‘èµ·ç™»å½•
await window.authService.auth0Login();      // Auth0ç™»å½•ï¼ˆæ¨èï¼‰
await window.authService.googleLogin();     // Googleç›´æ¥ç™»å½•
await window.authService.wechatLogin();     // å¾®ä¿¡ç™»å½•

// ç™»å‡º
window.authService.logout();

// å¸¦è®¤è¯çš„APIè°ƒç”¨
const response = await window.authService.authenticatedRequest('/api/some-endpoint', {
    method: 'POST',
    body: JSON.stringify({ data: 'example' })
});
```

### 2. ç”¨æˆ·ä¿¡æ¯ç»“æ„

```javascript
const user = {
    id: "123",
    username: "john_doe",
    email: "john@example.com",
    loginMethod: "Auth0",
    // å…¶ä»–ç”¨æˆ·ä¿¡æ¯...
};
```

## ğŸŒ é¡µé¢è·¯ç”±

### 1. ç™»å½•é¡µé¢
- **URL**: `https://bz.e.gaopf.top/login`
- **åŠŸèƒ½**: æ™ºèƒ½ç™»å½•é¡µé¢ï¼Œæ ¹æ®ç”¨æˆ·IPæ¨èç™»å½•æ–¹å¼

### 2. ç™»å½•æˆåŠŸé¡µé¢
- **URL**: `https://bz.e.gaopf.top/login/success`
- **å‚æ•°**: 
  - `token`: è®¿é—®ä»¤ç‰Œ
  - `user_id`: ç”¨æˆ·ID
  - `username`: ç”¨æˆ·å
  - `email`: é‚®ç®±
  - `login_method`: ç™»å½•æ–¹å¼

### 3. æ¼”ç¤ºé¡µé¢
- **URL**: `https://bz.e.gaopf.top/demo`
- **åŠŸèƒ½**: è®¤è¯åŠŸèƒ½æ¼”ç¤ºå’Œæµ‹è¯•

## ğŸ”„ ç™»å½•æµç¨‹

### 1. ç”¨æˆ·ç‚¹å‡»ç™»å½•
```javascript
// ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®
await window.authService.auth0Login();
```

### 2. è·³è½¬åˆ°Auth0
- ç”¨æˆ·è¢«é‡å®šå‘åˆ°Auth0ç™»å½•é¡µé¢
- ç”¨æˆ·é€‰æ‹©Googleè´¦å·ç™»å½•
- ç”¨æˆ·æˆæƒåº”ç”¨è®¿é—®Googleè´¦å·ä¿¡æ¯

### 3. å›è°ƒå¤„ç†
- Auth0å¤„ç†Googleç™»å½•
- è·å–ç”¨æˆ·ä¿¡æ¯
- é‡å®šå‘å›åº”ç”¨ï¼š`/login/success?token=xxx&user_id=xxx&...`

### 4. ä¿å­˜ç”¨æˆ·ä¿¡æ¯
```javascript
// è‡ªåŠ¨å¤„ç†ç™»å½•æˆåŠŸ
if (window.authService.handleLoginSuccess()) {
    console.log('ç™»å½•æˆåŠŸï¼');
    // ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜åˆ°localStorage
}
```

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### 1. ä»¤ç‰Œå­˜å‚¨
- è®¿é—®ä»¤ç‰Œå­˜å‚¨åœ¨`localStorage`ä¸­
- ä»¤ç‰Œä¼šè‡ªåŠ¨æ·»åŠ åˆ°APIè¯·æ±‚çš„Authorizationå¤´ä¸­
- ä»¤ç‰Œè¿‡æœŸæ—¶ä¼šè‡ªåŠ¨ç™»å‡ºç”¨æˆ·

### 2. è·¨åŸŸè¯·æ±‚
- ç¡®ä¿APIæœåŠ¡å™¨é…ç½®äº†æ­£ç¡®çš„CORSè®¾ç½®
- æ”¯æŒé¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰

### 3. HTTPS
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
- Auth0å›è°ƒURLå¿…é¡»ä½¿ç”¨HTTPS

## ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ

### 1. å“åº”å¼è®¾è®¡
```css
@media (max-width: 768px) {
    .login-container {
        width: 95%;
        padding: 20px;
    }
    
    .login-options {
        flex-direction: column;
        gap: 10px;
    }
}
```

### 2. ç§»åŠ¨ç«¯ç™»å½•
- æ”¯æŒç§»åŠ¨ç«¯æµè§ˆå™¨
- æ”¯æŒå¾®ä¿¡å†…ç½®æµè§ˆå™¨
- æ”¯æŒå„ç§ç§»åŠ¨è®¾å¤‡

## ğŸ”§ é…ç½®é€‰é¡¹

### 1. è‡ªå®šä¹‰ç™»å½•é¡µé¢
```javascript
// è‡ªå®šä¹‰ç™»å½•æŒ‰é’®æ ·å¼
const loginBtn = document.getElementById('loginBtn');
loginBtn.addEventListener('click', async () => {
    try {
        await window.authService.auth0Login();
    } catch (error) {
        // å¤„ç†ç™»å½•é”™è¯¯
        console.error('ç™»å½•å¤±è´¥:', error);
    }
});
```

### 2. è‡ªå®šä¹‰å›è°ƒå¤„ç†
```javascript
// ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
window.addEventListener('loginSuccess', (event) => {
    console.log('ç™»å½•æˆåŠŸ:', event.detail.user);
    // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
});

// ç›‘å¬ç™»å‡ºäº‹ä»¶
window.addEventListener('logout', () => {
    console.log('ç”¨æˆ·å·²ç™»å‡º');
    // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
});
```

## ğŸ› æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

**é—®é¢˜**: ç™»å½•åé¡µé¢æ²¡æœ‰è·³è½¬
**è§£å†³**: æ£€æŸ¥Auth0å›è°ƒURLé…ç½®æ˜¯å¦æ­£ç¡®

**é—®é¢˜**: ä»¤ç‰ŒéªŒè¯å¤±è´¥
**è§£å†³**: æ£€æŸ¥APIæœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ

**é—®é¢˜**: CORSé”™è¯¯
**è§£å†³**: æ£€æŸ¥APIæœåŠ¡å™¨CORSé…ç½®

### 2. è°ƒè¯•æ–¹æ³•

```javascript
// å¼€å¯è°ƒè¯•æ¨¡å¼
localStorage.setItem('debug', 'true');

// æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
console.log('ç”¨æˆ·ä¿¡æ¯:', window.authService.getCurrentUser());

// æŸ¥çœ‹ä»¤ç‰Œ
console.log('è®¿é—®ä»¤ç‰Œ:', window.authService.getToken());

// æµ‹è¯•APIè°ƒç”¨
window.authService.authenticatedRequest('/api/auth/me')
    .then(response => response.json())
    .then(data => console.log('APIå“åº”:', data))
    .catch(error => console.error('APIé”™è¯¯:', error));
```

## ğŸ“š æ›´å¤šèµ„æº

- [Auth0æ–‡æ¡£](https://auth0.com/docs)
- [FastAPIæ–‡æ¡£](https://fastapi.tiangolo.com/)
- [APIæ–‡æ¡£](https://bz.e.gaopf.top/api/docs)

## ğŸ†˜ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ç½‘ç»œè¯·æ±‚çŠ¶æ€
3. ç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
