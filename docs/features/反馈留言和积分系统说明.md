# 📝 反馈留言和积分系统说明

## 🎯 功能概述

本次更新为图片处理服务添加了两个重要功能模块：

1. **反馈留言模块** - 用户可以向管理员提交反馈、建议、bug报告等
2. **积分系统** - 用户通过签到、图片转换、提交反馈等活动获得积分

## 📋 功能详情

### 1. 反馈留言模块

#### 1.1 功能特性
- ✅ 用户可提交多种类型的反馈（Bug报告、功能建议、改进建议、投诉等）
- ✅ 支持优先级设置（低、中、高、紧急）
- ✅ 管理员可回复反馈并更新状态
- ✅ 用户可查看自己的反馈历史和状态
- ✅ 支持反馈搜索和筛选
- ✅ 提交反馈自动获得积分奖励

#### 1.2 反馈分类
- **Bug报告** (`bug`) - 系统错误、功能异常等
- **功能建议** (`feature`) - 新功能需求、功能改进等
- **改进建议** (`suggestion`) - 用户体验优化建议
- **投诉** (`complaint`) - 服务投诉、问题反馈
- **其他** (`other`) - 其他类型反馈

#### 1.3 反馈状态
- **待处理** (`pending`) - 新提交的反馈
- **处理中** (`processing`) - 管理员正在处理
- **已解决** (`resolved`) - 问题已解决
- **已关闭** (`closed`) - 反馈已关闭

### 2. 积分系统

#### 2.1 积分获取方式
- **每日签到** - 基础10积分，连续签到有额外奖励
- **图片转换** - 每次转换获得5积分
- **提交反馈** - 每次提交获得20积分
- **反馈被采纳** - 反馈被管理员采纳获得100积分
- **管理员调整** - 管理员手动调整积分

#### 2.2 连续签到奖励
- **第1天** - 10积分
- **第3天** - 50积分
- **第7天** - 150积分
- **第30天** - 500积分

#### 2.3 积分兑换
- **VIP升级** - 使用积分升级会员等级
- **转换额度** - 兑换额外的图片转换次数
- **功能解锁** - 解锁高级功能
- **其他物品** - 自定义兑换物品

## 🗄️ 数据库设计

### 1. 用户表扩展
```sql
-- 添加积分相关字段
ALTER TABLE users ADD COLUMN points INT DEFAULT 0 NOT NULL;
ALTER TABLE users ADD COLUMN last_checkin_date DATE NULL;
ALTER TABLE users ADD COLUMN consecutive_checkin_days INT DEFAULT 0 NOT NULL;
ALTER TABLE users ADD COLUMN total_checkin_days INT DEFAULT 0 NOT NULL;
```

### 2. 反馈留言表
```sql
CREATE TABLE feedbacks (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    category ENUM('bug', 'feature', 'suggestion', 'complaint', 'other'),
    status ENUM('pending', 'processing', 'resolved', 'closed'),
    priority ENUM('low', 'medium', 'high', 'urgent'),
    admin_reply TEXT NULL,
    admin_reply_time TIMESTAMP NULL,
    admin_user_id INT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 3. 积分记录表
```sql
CREATE TABLE point_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    points INT NOT NULL,
    type ENUM('earn', 'spend', 'expire', 'admin_adjust'),
    source ENUM('checkin', 'conversion', 'feedback', 'admin', 'exchange', 'other'),
    description VARCHAR(500) NOT NULL,
    related_id INT NULL,
    related_type VARCHAR(50) NULL,
    expires_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4. 签到记录表
```sql
CREATE TABLE checkin_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    checkin_date DATE NOT NULL,
    points_earned INT NOT NULL,
    consecutive_days INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 🚀 API接口

### 1. 反馈留言接口

#### 创建反馈
```http
POST /api/feedback/create
Content-Type: application/json
Authorization: Bearer <token>

{
    "title": "功能建议",
    "content": "希望能支持更多图片格式",
    "category": "feature",
    "priority": "medium"
}
```

#### 获取反馈列表
```http
GET /api/feedback/list?limit=10&offset=0&status=pending&category=feature
Authorization: Bearer <token>
```

#### 获取反馈详情
```http
GET /api/feedback/{feedback_id}
Authorization: Bearer <token>
```

#### 更新反馈
```http
PUT /api/feedback/{feedback_id}
Content-Type: application/json
Authorization: Bearer <token>

{
    "title": "更新后的标题",
    "priority": "high"
}
```

#### 删除反馈
```http
DELETE /api/feedback/{feedback_id}
Authorization: Bearer <token>
```

### 2. 积分系统接口

#### 用户签到
```http
POST /api/points/checkin
Authorization: Bearer <token>
```

#### 获取积分摘要
```http
GET /api/points/summary
Authorization: Bearer <token>
```

#### 获取积分记录
```http
GET /api/points/records?limit=20&offset=0&type=earn&source=checkin
Authorization: Bearer <token>
```

#### 获取签到记录
```http
GET /api/points/checkin/records?limit=30&offset=0
Authorization: Bearer <token>
```

#### 积分兑换
```http
POST /api/points/exchange
Content-Type: application/json
Authorization: Bearer <token>

{
    "item_name": "VIP升级",
    "item_type": "vip_upgrade",
    "points_cost": 1000,
    "item_value": "升级到VIP会员"
}
```

## 🧪 测试方法

### 1. 运行数据库迁移
```bash
# 执行数据库迁移脚本
mysql -u root -p image_convert_db < database_feedback_points_migration.sql
```

### 2. 启动服务
```bash
python main.py
```

### 3. 运行测试脚本
```bash
python test_feedback_points.py
```

## 📊 功能优势

### 1. 用户参与度提升
- 通过积分系统激励用户活跃使用
- 连续签到机制增加用户粘性
- 反馈系统让用户参与产品改进

### 2. 产品改进
- 收集用户真实反馈和建议
- 快速响应和解决用户问题
- 数据驱动的产品优化

### 3. 用户留存
- 积分奖励机制增加用户价值感
- 连续签到培养用户习惯
- 反馈被采纳提升用户满意度

### 4. 运营数据
- 用户活跃度统计
- 反馈问题分类统计
- 积分使用情况分析

## 🔧 配置说明

### 1. 积分规则配置
在 `point_rules` 表中可以配置不同的积分规则：
- 签到奖励规则
- 转换奖励规则
- 反馈奖励规则

### 2. 兑换物品配置
在 `point_exchanges` 表中可以配置可兑换的物品：
- VIP升级
- 转换额度
- 功能解锁
- 自定义物品

### 3. 权限控制
- 普通用户：只能管理自己的反馈和积分
- 管理员：可以回复反馈、审批兑换、调整积分

## 📈 后续扩展

### 1. 积分商城
- 更多兑换物品
- 限时兑换活动
- 积分排行榜

### 2. 反馈系统增强
- 反馈分类标签
- 反馈优先级自动调整
- 反馈处理时间统计

### 3. 用户等级系统
- 基于积分的用户等级
- 不同等级的特权
- 等级升级奖励

### 4. 数据分析
- 用户行为分析
- 积分使用趋势
- 反馈问题热力图

这个反馈留言和积分系统将大大提升用户体验和产品价值，让用户更积极地参与产品改进和使用服务！
